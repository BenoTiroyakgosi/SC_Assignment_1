# Practical: four

```{r load libraries and data, echo = FALSE ,include=FALSE}
library(tidyverse)
library(dplyr)
library(nycflights13)
data("flights")

```

## Question 1

```{r}
# This function displays columns and notes NA values

UtilsDataRSV::view_cols(flights)
```

## Question 2

```{r}


flight1 <- flights%>%
  filter(month == 1)%>%      # choosing all rows with a month value of 1
  group_by(carrier)%>%       # grouping by carrier to show carrier stats
  summarise(mean_distance = mean(distance),
            sd_distance = sd(distance))
flight1
```

## Question 3

The output above illustrates that carrier AS, HA, F9, YV and OO need to be investigated. The results shown below indicate that there are repeat values which is why the distance standard deviation for AS, HA, F9 and YV is zero.

```{r}

# From the output, the carriers with mean 0 and NA are AS, HA, F9, YV and OO


odd_carriers <- tibble(carrier = c("AS","HA", "F9", "OO", "YV"))


flights%>%
  filter(month == 1 )%>%
  semi_join(odd_carriers, join_by(carrier))%>%    # To leave desired carriers in tibble
  distinct(carrier, distance)                     # Shows the different values carriers have
```


The distance standard deviation of OO is NA and the output below shows that this is because there exists only one value during month 1. As a result the function `sd()` produces `NA`.

```{r}
#Showing how many entries of OO exist

flights%>%
  filter(carrier == "OO" & month == 1 )%>%
  select(carrier, month)
```

## Question 4


```{r}

flights %>%
  group_by(month, carrier) %>%   # grouping by two variables so they appear in final output
  summarise(
    avg_dep_delay = mean(dep_delay, na.rm = TRUE)
  ) %>%
  pivot_wider(names_from = carrier, values_from = avg_dep_delay)
```

## Question 5

```{r}
# tibble which meets conditions

flight_condition<-  flights%>%
  filter(dep_delay > 0 & arr_delay <= 0)

total_flights <- nrow(flights)           # number of total flights
met_condition <- nrow(flight_condition)  # number of flights which met condition

prop_of_flights <- met_condition / total_flights 
print(prop_of_flights)
```

## Question 6: Part 1 and 2

```{r}


multi_routes <- flights %>%            
  group_by(origin, dest) %>%            # grouping allowing for count in the next line  
  filter(n_distinct(carrier) > 1) %>%   # filtering out non-repeat routes 
  ungroup()

avg_arr_delay <- multi_routes %>%
  group_by(origin, dest, carrier) %>%   
  summarise(
    arr_del_avg = mean(arr_delay, na.rm = TRUE),
    .groups = "drop"
  )

avg_arr_delay

```

## Question 6: Part 3

```{r}

# filter is used to keep the carrier with lowest delay time per route

avg_arr_delay %>% 
  group_by(origin, dest) %>%            
  filter(arr_del_avg == min(arr_del_avg, na.rm = TRUE)) %>%  
  ungroup()

```

## Question 6: Part 4


```{r}

avg_arr_delay %>%
  group_by(origin, dest) %>%
  summarise(
    best_delay  = min(arr_del_avg, na.rm = TRUE), # smallest delay by route
    worst_delay = max(arr_del_avg, na.rm = TRUE), # largest delay by route
    diff_del    = worst_delay - best_delay,        
    .groups = "drop"
  )%>%
  filter(diff_del == max(diff_del, na.rm =TRUE)) # retain only the largest delay


```

